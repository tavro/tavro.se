const entries = [
  {
	date: "2026-01-30",
	category: "career",
	title: "GOTO 10 is closing",
	body: "<blockquote cite=\"https://www.goto10.se/goto-10-stanger/\">On Friday, 27 February 2026, Goto 10 in Linköping and Malmö will close their doors for the final time. Event bookings are already closed and will not reopen. You can book both the podcast studio and meeting rooms as usual, and the events already scheduled in February will still be open to attend. When the Internet Foundation opened Goto 10 Stockholm in 2017, the goal was to lower barriers and promote innovation and entrepreneurship. Since then, the landscape around these issues has changed. At the end of 2025, a new strategic direction was adopted for the Internet Foundation, and it is against this background that Goto 10 is now being phased out. As we close, we would like to thank you for nine fantastic years of events, knowledge sharing, and meetings. We started Goto 10 with the ambition of building strong communities, and as we now close this chapter, we hope you share the feeling that we succeeded.</blockquote>",
	sources: {
		"goto 10": "https://www.goto10.se/goto-10-stanger/"
        },
	comment: "this is so sad. <\\3 i first became a member of goto 10 in september 2022, over three years ago, when i founded the <a href=\"https://webbu.se/hackathon\">webbu hackathon</a>. they let us use their spaces for free to host our hackathon event. they provided free internet, electricity, and an awesome space to be in. after the event, we kept in contact and continued hosting our events there for at least one more year. then i founded LiTHe Hax, and we hosted regular events there almost once a month every month of the year since then. it was not just a great place to hang out and study, but also to meet new people and get inspired. once again, i talk for me and many of my friends when i say this: we are so sad to see goto 10 go. i have been in contact with the project manager and other people related to the project, and they will try to find other spaces to recreate this collaboratory spirit. i wish everyone involved good luck, and i hope that me and my organizations will still be a part of the community in one way or another... :'-)<3 thanks for everything, for all the friend i've found, for helping me with my career and all the projects that became true because of you, also thanks to <a href=\"https://linkopingsciencepark.se\">LSP</a> and <a href=\"https://internetstiftelsen.se\">internetstiftelsen</a>. you guys are the best!"
  },
  {
	date: "2026-01-24",
	category: "ai",
	title: "AI is a horse",
	body: "<blockquote cite=\"https://kconner.com/2024/08/02/ai-is-a-horse.html\"><ul><li>It is faster than your feet depending on the terrain</li><li>It is way slower and less reliable than a train but can go more places</li><li>It eats a lot</li><li>You cannot simply tell it to go to the store for you</li><li>You have to tell it where to turn even if it might guess right sometimes</li><li>You have to keep it on the road even if it usually stays on the road</li><li>You can only lead it to water, you cannot make it drink</li><li>A good one runs at the shadow of the whip</li><li>We are skeptical of those that talk</li></ul></blockquote>",
	sources: {
		"kconner.com": "https://kconner.com/2024/08/02/ai-is-a-horse.html"
	},
	comment: "ai is a horse."
  },
  {
	date: "2026-01-14",
	category: "ai",
	title: "about anti-AI hype",
	body: "<blockquote cite=\"https://antirez.com/news/158\">I love writing software, line by line. It could be said that my career was a continuous effort to create software well written, minimal, where the human touch was the fundamental feature. I also hope for a society where the last are not forgotten. Moreover, I don't want AI to economically succeed. But, I would not respect myself and my intelligence if my idea of software and society would impair my vision: facts are facts, and AI is going to change programming forever.</blockquote>",
	sources: {
		"Salvatore Sanfilippo": "https://antirez.com/news/158"
	},
	comment: "i have slightly edited the quote to omit the author's extreme political and economic opinions, in general i agree with this post a lot."
  },
  {
	date: "2026-01-14",
	category: "ai",
	title: "did AI kill Tailwind's business?",
	body: "<blockquote cite=\"https://github.com/tailwindlabs/tailwindcss.com/pull/2388#issuecomment-3717222957\">[1] The reality is that 75% of the people on our engineering team lost their jobs here yesterday because of the brutal impact AI has had on our business. Traffic to our docs is down about 40% from early 2023 despite Tailwind being more popular than ever. <blockquote cite=\"https://dri.es/ai-is-a-business-model-stress-test\">[2] AI didn't kill Tailwind's business. It stress tested it. Their business model failed the test, but that is not an indictment of all Open Source business models. Tailwind's business model worked for years. It relied on developers visiting their documentation, discovering Tailwind Plus while browsing, and buying it. Tailwind Plus is a $299 collection of pre-built UI components. Traffic led to discovery, and discovery drove sales. It was a reasonable business model, but always fragile. In the last year, more and more developers started asking AI for code instead of reading documentation, and their sales and marketing funnel broke.</blockquote></blockquote>",
	sources: {
		"Adam Wathan": "https://github.com/tailwindlabs/tailwindcss.com/pull/2388#issuecomment-3717222957",
		"Dries Buytaert": "https://dri.es/ai-is-a-business-model-stress-test"
	},
	comment: "i think Dries makes a good point here. the truth is probably somewhere in between. but what do i know? i am not running a company. still, i definitely think companies will have to adapt their business models to account for the integration of AI into society. on a positive note, <a href=\"https://x.com/OfficialLoganK/status/2009339263251566902\">Google are now sponsoring Tailwind</a>."
  },
  {
	date: "2026-01-22",
	category: "career",
	title: "addicted to being useful",
	body: "<blockquote cite=\"https://www.seangoedecke.com/addicted-to-being-useful/\">When I get together with my friends in the industry, I feel a little guilty about how much I love my job. This is a tough time to be a software engineer. The job was less stressful in the late 2010s than it is now, and I sympathize with anyone who is upset about the change. There are a lot of objective reasons to feel bad about work. But despite all that, I’m still having a blast. I enjoy pulling together projects, figuring out difficult bugs, and writing code in general. I like spending time with computers. But what I really love is being useful.</blockquote>",
	sources: {
		"sean goedecke": "https://www.seangoedecke.com/addicted-to-being-useful/"
	},
	comment: "relatable! :-)"
  },
  {
	date: "2026-01-21",
	category: "career",
	title: "recent hires do not have degrees",
	body: "<blockquote cite=\"https://www.yahoo.com/news/articles/google-cofounder-reveals-tons-recent-231500103.html\">Data from the Burning Glass Institute shows that in 2017, degree requirements were part of 93% of job postings at Google. By 2022, that figure had dropped to 77%. Other large tech companies have also begun judging candidates by their abilities instead of their diplomas. Microsoft, Apple, and Cisco are among those dropping degree mandates. This shift raises questions about what a college education is worth, especially as artificial intelligence tools got better at performing tasks that once required formal training. If you spent years and tens of thousands of dollars earning a degree, companies' hiring people without that credential might feel frustrating. The change could leave graduates wondering if their time and money were well-spent.</blockquote>",
	sources: {
		"yahoo!news": "https://www.yahoo.com/news/articles/google-cofounder-reveals-tons-recent-231500103.html"
	},
	comment: "this is quite sad. i still remember deciding what i wanted to study at university when i was just 13 years old. like many others, a major motivation for getting a master's degree in computer science was being hired by one of the FAANG companies. fortunately, i got my degree in Sweden and didn't have to financially ruin myself in the process. i do understand the frustration of those who put their entire lives on the line in the hope that a degree would secure them a job at a fortune company. my perspective has changed over time. i'm grateful for my education, and i'm genuinely happy for those who do manage to work at these companies, especially when they may not have had the opportunity or circumstances to attend university at all."
  },
  {
	date: "2026-01-16",
	category: "career",
	title: "nothing is sacred in programming",
	body: "<blockquote cite=\"https://agentultra.com/blog/how-i-learned-everything-i-know/index.html\">I have never met a group of people so passionate about sharing what they know with anyone than programmers. This is not an industry that jealously guards its knowledge and keeps secrets. We give away source code, books, blog posts, presentations, video tutorials, etc for free. We get excited about teaching people. And I got to where I am thanks to people like me who wrote down and shared their knowledge openly and freely. I’ve benefited from open source. From books people have published online for free and courses they’ve given away. I’ve learned a great deal from people I chat with online, over forums, and at meetups where people give presentations to share their knowledge and work. There is nothing sacred in programming. If you want to learn how operating systems work there are free books, full source code, forums, chat rooms, email lists, meetups, blog posts, video seminars, tutorials and everything you possibly need available to you. Interested in compilers? Databases? Distributed systems? Put your hand up and there will be someone eager to help you and teach you everything they know.</blockquote>",
	sources: {
		"Agentultra": "https://agentultra.com/blog/how-i-learned-everything-i-know/index.html"
	},
	comment: "preach!"
  },
  {
	date: "2026-01-23",
	category: "tech",
	title: "IP over avian carriers with quality of service",
	body: "<p><a href=\"https://www.rfc-editor.org/rfc/rfc2549.html\">link</a>, and related <a href=\"https://en.wikipedia.org/wiki/IP_over_Avian_Carriers\">wiki</a> article you have probably seen before.</p>",
	sources: {
		"rfc-editor.org": "https://www.rfc-editor.org/rfc/rfc2549.html",
		"wikipedia": "https://en.wikipedia.org/wiki/IP_over_Avian_Carriers"
	},
	comment: "i love the internet"
  },
  {
	date: "2026-01-18",
	category: "random",
	title: "why airplanes still have ashtrays",
	body: "<div class=\"horizontal-pair\"><img src=\"res/notes/ashtray.jpg\" /><p>i recently traveled to the U.S. and noticed an ashtray in the airplane bathroom, which seemed odd since smoking is clearly prohibited on flights. apparently, they are required for safety reasons. if someone does illegally smoke, an ashtray prevents a lit cigarette from ending up in the trash and starting a fire. <a href=\"https://www.faa.gov/media/33511\">[1]</a> newly built aircraft still include these ashtrays as part of their lavatory design to meet FAA and international standards. <a href=\"https://iatanews.com/why-newly-built-aircraft-still-have-ashtrays-in-the-toilet/\">[2]</a></p></div>",
	sources: {
		"faa.gov": "https://www.faa.gov/media/33511",
		"iatanews": "https://iatanews.com/why-newly-built-aircraft-still-have-ashtrays-in-the-toilet/"
	},
	comment: ""
  }
];

document.addEventListener("DOMContentLoaded", () => {
  const canvas = document.getElementById("note-canvas");
  const ctx = canvas.getContext("2d");
  const preview = document.getElementById("note-preview");

  const NOTE_SIZE = 28;
  const NOTE_HIT_RADIUS = 14;
  const CLUSTER_RADIUS = 45;
  const CATEGORY_SPACING = 120;
  const MAX_PLACEMENT_ATTEMPTS = 100;

  const palette = ["#ff6b6b", "#4dabf7", "#51cf66", "#ffd43b", "#9775fa"];
  const categoryColors = {};
  let colorIndex = 0;

  entries.forEach(e => {
    if (!categoryColors[e.category]) {
      categoryColors[e.category] = palette[colorIndex++ % palette.length];
    }
  });

  const categories = [...new Set(entries.map(e => e.category))];
  let circles = [];
  let clusterCenters = {};
  let activeCircle = null;

  const noteImage = new Image();
  let noteImageReady = false;
  const tintedCache = new Map();

  noteImage.onload = () => {
    noteImageReady = true;
    init();
  };

  noteImage.onerror = () => {
    console.warn("note.png failed to load");
    init();
  };

  noteImage.src = "res/notes/note.png";

  function getTintedNote(color) {
    if (!noteImageReady) return null;

    if (tintedCache.has(color)) return tintedCache.get(color);

    const off = document.createElement("canvas");
    off.width = NOTE_SIZE;
    off.height = NOTE_SIZE;
    const octx = off.getContext("2d");

    octx.drawImage(noteImage, 0, 0, NOTE_SIZE, NOTE_SIZE);

    octx.globalCompositeOperation = "source-atop";
    octx.fillStyle = color;
    octx.fillRect(0, 0, NOTE_SIZE, NOTE_SIZE);
    octx.globalCompositeOperation = "source-over";

    tintedCache.set(color, off);
    return off;
  }

  function resizeCanvas() {
    const rect = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }

  function clamp(v, min, max) {
    return Math.max(min, Math.min(max, v));
  }

  function computeClusterCenters() {
    const w = canvas.width / devicePixelRatio;
    const h = canvas.height / devicePixelRatio;

    clusterCenters = {};
    categories.forEach((cat, i) => {
      const angle = (i / categories.length) * Math.PI * 2;
      let x = w / 2 + Math.cos(angle) * CATEGORY_SPACING;
      let y = h / 2 + Math.sin(angle) * CATEGORY_SPACING;

      x = clamp(x, NOTE_SIZE, w - NOTE_SIZE);
      y = clamp(y, NOTE_SIZE, h - NOTE_SIZE);

      clusterCenters[cat] = { x, y };
    });
  }

  function circlesOverlap(a, b) {
    return Math.hypot(a.x - b.x, a.y - b.y) < a.radius + b.radius;
  }

  function isPointInCircle(px, py, c) {
    return Math.hypot(px - c.x, py - c.y) <= c.radius;
  }

  function placeCircles() {
    circles = [];
    const w = canvas.width / devicePixelRatio;
    const h = canvas.height / devicePixelRatio;

    entries.forEach(entry => {
      const center = clusterCenters[entry.category];

      for (let i = 0; i < MAX_PLACEMENT_ATTEMPTS; i++) {
        const angle = Math.random() * Math.PI * 2;
        const dist = Math.random() * CLUSTER_RADIUS;

        const x = clamp(center.x + Math.cos(angle) * dist, NOTE_SIZE, w - NOTE_SIZE);
        const y = clamp(center.y + Math.sin(angle) * dist, NOTE_SIZE, h - NOTE_SIZE);

        const candidate = { x, y, radius: NOTE_HIT_RADIUS };

        if (!circles.some(c => circlesOverlap(candidate, c))) {
          circles.push({
            ...candidate,
            entry,
            color: categoryColors[entry.category],
            hovered: false
          });
          break;
        }
      }
    });
  }

  function renderSources(sources = {}) {
    const items = Object.entries(sources);
    if (!items.length) return "";

    const label = items.length === 1 ? "source" : "sources";

    const links = items
      .map(([name, url], i) =>
        `<a href="${url}" target="_blank" rel="noopener">[${i + 1}] ${name}</a>`
      )
      .join(", ");

    return `<small>${label}: ${links}</small>`;
  }

  function renderEntry(entry) {
    preview.innerHTML = `
      <article class="note">
        <h3>${entry.title}</h3>
        ${entry.body}
        ${renderSources(entry.sources)}
        ${entry.comment ? `<p class="comment"><b>@tavro:</b> ${entry.comment}</p>` : ""}
      </article>
    `;
  }

  function drawTitlePreview(circle) {
    const text = circle.entry.title;
    ctx.font = "13px system-ui, sans-serif";

    const padding = 6;
    const w = ctx.measureText(text).width + padding * 2;
    const h = 22;

    const x = circle.x + 16;
    const y = circle.y - h - 8;

    ctx.fillStyle = "rgba(0,0,0,0.8)";
    ctx.fillRect(x, y, w, h);

    ctx.fillStyle = "#fff";
    ctx.textBaseline = "middle";
    ctx.fillText(text, x + padding, y + h / 2);
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    circles.forEach(c => {
      const color = c.hovered ? "#ffffff" : c.color;
      const img = getTintedNote(color);

      if (img) {
        ctx.drawImage(
          img,
          c.x - NOTE_SIZE / 2,
          c.y - NOTE_SIZE / 2,
          NOTE_SIZE,
          NOTE_SIZE
        );
      }
    });

    const hovered = circles.find(c => c.hovered);
    if (hovered) drawTitlePreview(hovered);
  }

  canvas.addEventListener("mousemove", e => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    let hovering = false;
    let redraw = false;

    circles.forEach(c => {
      const prev = c.hovered;
      c.hovered = isPointInCircle(mx, my, c);
      if (c.hovered) hovering = true;
      if (prev !== c.hovered) redraw = true;
    });

    canvas.style.cursor = hovering ? "pointer" : "default";
    if (redraw) draw();
  });

  canvas.addEventListener("click", e => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    circles.forEach(c => {
      if (isPointInCircle(mx, my, c)) {
        activeCircle = c;
        renderEntry(c.entry);
        draw();
      }
    });
  });

  function init() {
    resizeCanvas();
    computeClusterCenters();
    placeCircles();
    draw();
  }

  window.addEventListener("resize", init);
});

